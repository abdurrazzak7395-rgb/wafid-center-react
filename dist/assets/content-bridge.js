(()=>{const d=new Set(["http://localhost:3000"]),g="automation-run-row",a="automation-result",p=6e4,u=o=>d.size===0||d.has(o),n=new Map;console.log("[BRIDGE] loaded on",location.origin),window.addEventListener("message",o=>{console.log("[BRIDGE] window.message",{origin:o.origin,data:o.data});try{if(!u(o.origin)){console.warn("[BRIDGE] blocked origin:",o.origin);return}const t=o.data;if(!t||typeof t!="object"||t.type!==g)return;const{requestId:e,index:i,row:w,timeoutMs:y}=t;if(!e||n.has(e))return;const E=setTimeout(()=>{n.delete(e);const r={type:a,requestId:e,ok:!1,error:"Timeout waiting for background response",_via:"content-bridge-timeout"};try{window.postMessage(r,o.origin)}catch(s){console.error("[BRIDGE] postMessage timeout notify failed:",s)}},y??p);n.set(e,{origin:o.origin,timerId:E}),chrome.runtime.sendMessage({type:g,requestId:e,index:i,row:w},r=>{const s=chrome.runtime?.lastError,c=n.get(e);if(!c)return;clearTimeout(c.timerId),n.delete(e);const l=r&&typeof r=="object"?{...r,_via:"content-bridge"}:{type:a,requestId:e,ok:!s,error:s?.message??(r==null?"No response":void 0),_via:"content-bridge"};try{console.log("[BRIDGE] posting back to page:",l),window.postMessage(l,c.origin)}catch(I){console.error("[BRIDGE] postMessage back failed:",I)}})}catch(t){try{const e=o?.data?.requestId??`req_${Date.now()}`,i={type:a,requestId:e,ok:!1,error:String(t),_via:"content-bridge-catch"};console.error("[BRIDGE] exception:",i),window.postMessage(i,o.origin||"*")}catch(e){console.error("[BRIDGE] exception notify failed:",e)}}});try{window.postMessage({type:"bridge-ready",at:Date.now()},"*")}catch(o){console.warn("[BRIDGE] bridge-ready post failed:",o)}})();
//# sourceMappingURL=content-bridge.js.map
