(()=>{const c=new Set(["http://localhost:3000","https://wafid.com"]),d="automation-run-row",n="automation-result",l=6e4,u=o=>c.size===0||c.has(o),s=new Map;window.addEventListener("message",o=>{console.log(o,"event");try{if(!u(o.origin)){console.warn("[BRIDGE] blocked origin:",o.origin);return}const t=o.data;if(!t||typeof t!="object"||t.type!==d)return;const{requestId:e,index:i,row:p,timeoutMs:w}=t;if(!e||s.has(e))return;const y=setTimeout(()=>{s.delete(e);const r={type:n,requestId:e,ok:!1,error:"Timeout waiting for background response",_via:"content-bridge-timeout"};window.postMessage(r,o.origin)},w??l);s.set(e,{origin:o.origin,timerId:y}),chrome.runtime.sendMessage({type:d,requestId:e,index:i,row:p},r=>{const g=chrome.runtime?.lastError,a=s.get(e);if(!a)return;clearTimeout(a.timerId),s.delete(e);const m=r&&typeof r=="object"?{...r,_via:"content-bridge"}:{type:n,requestId:e,ok:!g,error:g?.message??(r==null?"No response":void 0),_via:"content-bridge"};try{window.postMessage(m,a.origin)}catch(f){console.error("[BRIDGE] postMessage back failed:",f)}})}catch(t){try{const e=o?.data?.requestId??`req_${Date.now()}`,i={type:n,requestId:e,ok:!1,error:String(t),_via:"content-bridge-catch"};console.error("[BRIDGE] exception:",i),window.postMessage(i,o.origin||"*")}catch(e){console.error("[BRIDGE] exception notify failed:",e)}}});try{window.postMessage({type:"bridge-ready",at:Date.now()},"*")}catch(o){console.warn("[BRIDGE] bridge-ready post failed:",o)}})();
//# sourceMappingURL=content-bridge.js.map
